SELECT
CONTAMOV.NUMEROCM||'#1' AS OSRTV,
1 AS EMPRESA,
CONTAMOV.NUMEROCM AS COD_RTV,
CASE    
    WHEN  DTREFERENCIA BETWEEN '01/07/2016' AND '30/06/2017' THEN '1617'
    WHEN  DTREFERENCIA BETWEEN '01/07/2017' AND '30/06/2018' THEN '1718'
    WHEN  DTREFERENCIA BETWEEN '01/07/2018' AND '30/06/2019' THEN '1819'
    WHEN  DTREFERENCIA BETWEEN '01/07/2019' AND '30/06/2020' THEN '1920'
    WHEN  DTREFERENCIA BETWEEN '01/07/2020' AND '30/06/2021' THEN '2021'
    WHEN  DTREFERENCIA BETWEEN '01/07/2021' AND '30/06/2022' THEN '2122'
    WHEN  DTREFERENCIA BETWEEN '01/07/2022' AND '30/06/2023' THEN '2223' 
	WHEN  DTREFERENCIA BETWEEN '01/07/2023' AND '30/06/2024' THEN '2324'
	WHEN  DTREFERENCIA BETWEEN '01/07/2024' AND '30/06/2025' THEN '2425'      
    WHEN  DTREFERENCIA BETWEEN '01/07/2025' AND '30/06/2026' THEN '2526' 
    WHEN  DTREFERENCIA BETWEEN '01/07/2026' AND '30/06/2027' THEN '2627' 
    WHEN  DTREFERENCIA BETWEEN '01/07/2027' AND '30/06/2028' THEN '2728' 
    WHEN  DTREFERENCIA BETWEEN '01/07/2028' AND '30/06/2029' THEN '2829'         
END OSSAFRA,
DTREFERENCIA AS DATA,
SUM(CASE WHEN UPPER(DESCEVENTO) LIKE '%COMISS%' THEN 0 ELSE VALOR END) AS VLR_BRTMENSAL,
SUM(CASE 
    WHEN TPEVENTO = 'Desconto' AND UPPER(DESCEVENTO) LIKE '%COMISS%' THEN VALOR * -1
    WHEN UPPER(DESCEVENTO) LIKE '%COMISS%' THEN VALOR 
    ELSE 0 
END
) VLR_COMMENSAL,
0 VLR_COMAPU,
SUM((CASE WHEN TPEVENTO = 'Desconto' THEN VALOR ELSE 0 END)) VLR_ENCARGOS,
0 VLR_COMPF,
CASE WHEN CONTAMOV.NUMEROCM IN (2179,7648,9270) THEN 'N' ELSE 'S' END RECCOM
FROM U_CUSTO_SENIOR C
LEFT JOIN CONTAMOV ON CONTAMOV.CNPJF = C.CPF
INNER JOIN CONTAMOVFUNCIONARIO F ON F.NUMEROCM = CONTAMOV.NUMEROCM
INNER JOIN CARGO ON CARGO.IDCARGO = F.CARGO
WHERE
--DTREFERENCIA >= '01/04/2024'
--AND 
CARGO.IDCARGO IN (2,3,7,95,96,97,205,261)
GROUP BY
CONTAMOV.NUMEROCM,
DTREFERENCIA
